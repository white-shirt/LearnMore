# 1. http 缓存机制  

当一个用户发起一个静态资源请求的时候，浏览器会通过以下几个步骤来获取资源：  
1. 本地缓存阶段：现在本地查找该资源，如果有发现该资源，而且该资源还没有过期，就使用这一个资源，完全不会发送 http 请求到服务器
2. 协商缓存阶段：如果在本地缓存找到对应的资源，但是不知道该资源是否过期或者已经过期，则发一个 http 请求到服务器，然后服务器判断这个请求，如果请求的资源在服务器上没有改动过，则返回 304，让浏览器使用本地找到的那个资源
3. 缓存失败阶段：当服务器发现请求的资源已经修改过，或者这是一个新的请求（在本来没有找到资源），服务器则返回该资源的数据，并且返回 200，当然这个是值找到资源的情况下，如果服务器上没有这个资源，则返回 404  

# 2. 强制缓存  

强制缓存就是像浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程，强制缓存的情况主要有三种，如下：  
* 不存在该缓存结果，像服务器发起请求
* 存在该缓存结果，则使用协商缓存
* 存在缓存结果，且结果没有失效，强制缓存生效，直接使用该缓存结果  

当浏览器想服务器发起请求时，服务器会将缓存规则放入 HTTP 响应报文的 HTTP 头中和请求结果一起返回给浏览器，控制强制缓存的字段分别是 Expires 和 Cache-Control，其中 Cache-Control 优先级比 Expires 高。  

# 3. Expires  

服务器返回结果中控制请求结果的缓存到期时间，当请求时间小于 Expires 的值，则使用缓存的结果。  

# 4. Cache-Control  


Cache-Control 主要用于网页缓存，其主要取值为：  
* public 所有内容都可以缓存（客户端和代理服务器都可以缓存）
* private 所有内容只有客户端可以缓存，默认值
* no-cache 客户端缓存内容，但是是否使用需要经过协商缓存
* no-store 所有内容不缓存
* max-age = xxx 缓存将在 xxx 秒后失效  

# 5. 协商缓存  

协商缓存就是强制缓存失效后，浏览器携带缓存标识像服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程，主要有以下两种情况：  
* 协商缓存生效，返回 304，即数据未更改可以继续使用。  
* 协商缓存失效，返回 200，数据已发生更改，并返回客户端新的数据。

